{
  "openapi": "3.0.3",
  "info": {
    "title": "Birthday Message Scheduler API",
    "description": "## Overview\nProduction-ready API for scheduling birthday and anniversary messages with timezone support.\n\n## Features\n- **User Management**: CRUD operations for users with timezone support\n- **Message Scheduling**: Automatic message scheduling based on user timezone (at 9am local time)\n- **Health Monitoring**: System health and readiness endpoints\n- **Prometheus Metrics**: Production-ready observability and monitoring\n- **Redis Caching**: High-performance caching for improved response times\n\n## Architecture\n\n| Component | Technology | Purpose |\n|-----------|------------|---------|\n| **Database** | PostgreSQL + Drizzle ORM | Persistent data storage |\n| **Queue** | RabbitMQ | Message processing and delivery |\n| **Cache** | Redis | High-performance caching |\n| **Scheduler** | CRON-based | Timezone-aware scheduling |\n\n## Caching Strategy\n\nThis API uses Redis caching to improve performance and reduce database load:\n\n### Cached Data\n\n| Data | TTL | Key Pattern |\n|------|-----|-------------|\n| User by ID | 1 hour | `user:v1:{id}` |\n| User by Email | 1 hour | `user:email:v1:{email}` |\n| Birthdays Today | Until midnight | `birthdays:today:v1` |\n| Anniversaries Today | Until midnight | `anniversaries:today:v1` |\n\n### Cache Behavior\n\n- **GET requests**: Served from cache when available (eventual consistency)\n- **POST requests**: Cache warmed after creation for faster subsequent reads\n- **PUT/DELETE requests**: Cache invalidated after modification to ensure consistency\n- **Graceful degradation**: API works without Redis (cache is optional)\n\n### Consistency Models\n\n- **Strong consistency**: Write operations always hit the database\n- **Eventual consistency**: Read operations may return cached data (up to 1 hour stale)\n- **Weak consistency**: Daily lists (birthdays/anniversaries) refresh at midnight UTC",
    "version": "1.0.0",
    "contact": {
      "name": "API Support",
      "email": "support@example.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "components": {
    "schemas": {
      "def-0": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "firstName": {
            "type": "string"
          },
          "lastName": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "timezone": {
            "type": "string",
            "example": "America/New_York"
          },
          "birthdayDate": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "anniversaryDate": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "locationCity": {
            "type": "string",
            "nullable": true
          },
          "locationCountry": {
            "type": "string",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "title": "User"
      },
      "def-1": {
        "type": "object",
        "required": [
          "firstName",
          "lastName",
          "email",
          "timezone"
        ],
        "properties": {
          "firstName": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "lastName": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "timezone": {
            "type": "string",
            "example": "America/New_York"
          },
          "birthdayDate": {
            "type": "string",
            "format": "date-time"
          },
          "anniversaryDate": {
            "type": "string",
            "format": "date-time"
          },
          "locationCity": {
            "type": "string",
            "maxLength": 100
          },
          "locationCountry": {
            "type": "string",
            "maxLength": 100
          }
        },
        "title": "CreateUserRequest"
      },
      "def-2": {
        "type": "object",
        "properties": {
          "firstName": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "lastName": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "timezone": {
            "type": "string",
            "example": "America/New_York"
          },
          "birthdayDate": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "anniversaryDate": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "locationCity": {
            "type": "string",
            "maxLength": 100,
            "nullable": true
          },
          "locationCountry": {
            "type": "string",
            "maxLength": 100,
            "nullable": true
          }
        },
        "title": "UpdateUserRequest"
      },
      "def-3": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "healthy",
              "unhealthy"
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "uptime": {
            "type": "number"
          },
          "version": {
            "type": "string"
          }
        },
        "title": "HealthResponse"
      },
      "def-4": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "details": {
                "type": "object"
              }
            }
          }
        },
        "title": "ErrorResponse"
      },
      "def-5": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object"
          },
          "meta": {
            "type": "object",
            "properties": {
              "timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "requestId": {
                "type": "string"
              }
            }
          }
        },
        "title": "SuccessResponse"
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "tags": [
          "health"
        ],
        "description": "Check if the service is running",
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-3"
                }
              }
            }
          }
        }
      }
    },
    "/ready": {
      "get": {
        "summary": "Readiness check",
        "tags": [
          "health"
        ],
        "description": "Check if the service is ready to accept requests",
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-3"
                }
              }
            }
          },
          "503": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          }
        }
      }
    },
    "/live": {
      "get": {
        "summary": "Liveness check",
        "tags": [
          "health"
        ],
        "description": "Kubernetes liveness probe - checks if the service is alive",
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-3"
                }
              }
            }
          }
        }
      }
    },
    "/health/schedulers": {
      "get": {
        "summary": "Scheduler health check",
        "tags": [
          "health"
        ],
        "description": "Check the health status of all CRON schedulers",
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-5"
                }
              }
            }
          }
        }
      }
    },
    "/metrics": {
      "get": {
        "summary": "Prometheus metrics",
        "tags": [
          "metrics"
        ],
        "description": "Get Prometheus-formatted metrics for monitoring",
        "responses": {
          "200": {
            "description": "Prometheus text format metrics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "description": "Prometheus text format metrics"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/summary": {
      "get": {
        "summary": "Metrics summary",
        "tags": [
          "metrics"
        ],
        "description": "Get a JSON summary of all metrics for debugging",
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-5"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/users": {
      "post": {
        "summary": "Create a new user",
        "tags": [
          "users"
        ],
        "description": "Create a new user with timezone support. The system will automatically schedule birthday and anniversary messages at 9am in the user's local timezone. Cache is warmed after successful creation for faster subsequent reads.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/def-1"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-5"
                }
              }
            }
          },
          "400": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          },
          "409": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/users/{id}": {
      "get": {
        "summary": "Get user by ID",
        "tags": [
          "users"
        ],
        "description": "Retrieve a specific user by their UUID. Results may be served from cache (up to 1 hour stale).",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "in": "path",
            "name": "id",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-5"
                }
              }
            }
          },
          "404": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Update user",
        "tags": [
          "users"
        ],
        "description": "Update an existing user. If birthday or anniversary date is changed, the system will automatically reschedule the corresponding messages. Cache is invalidated after update to ensure consistency.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/def-2"
              }
            }
          }
        },
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "in": "path",
            "name": "id",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-5"
                }
              }
            }
          },
          "400": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          },
          "404": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          },
          "409": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete user",
        "tags": [
          "users"
        ],
        "description": "Soft delete a user. The user record is marked as deleted but retained in the database. Any pending messages for this user will be cancelled. Cache is invalidated after deletion.",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "in": "path",
            "name": "id",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-5"
                }
              }
            }
          },
          "404": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/def-4"
                }
              }
            }
          }
        }
      }
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    },
    {
      "url": "https://api.example.com",
      "description": "Production server"
    }
  ],
  "tags": [
    {
      "name": "health",
      "description": "Health check endpoints for monitoring and orchestration"
    },
    {
      "name": "metrics",
      "description": "Prometheus metrics endpoints for observability"
    },
    {
      "name": "users",
      "description": "User management operations (CRUD)"
    }
  ]
}